---
import { getCollection } from "astro:content";

import Section from "../../Section.astro";
import { useTranslation } from "../../../i18n/useTranslation";
import Project from "../../../components/Project.astro";
import ProjectsGrid from "../../../components/ProjectsGrid.astro";
import Slider from "../../../components/Slider.astro";
import splitIntoChunks from "../../../helpers/splitIntoChunks.mts";
import toSlug from "../../../helpers/toSlug.mts";
import { Languages, type Language } from "../../../i18n/languages";

interface Props {
  language: Language;
}

const { language } = Astro.props;

const t = useTranslation(language);
const projectsCollection = await getCollection("projects");
const projectsContentChunks = splitIntoChunks(
  await Promise.all(
    projectsCollection
      .filter(({ slug }) => slug.startsWith(language))
      .map(async (entry) => {
        return {
          ...entry,
          Content: (await entry.render()).Content,
        };
      }),
  ),
  4,
);
---

<Section title={t("section_titles.projects")}>
  <Slider language={language}>
    {
      projectsContentChunks.map((chunk) => {
        return (
          <ProjectsGrid>
            {chunk.map((entry) => (
              <Project
                href={`/${
                  language !== Languages.PL ? `${language}/` : ""
                }${toSlug(entry.data.name)}`}
                language={language}
                name={entry.data.name}
              >
                {entry.data.description}
              </Project>
            ))}
          </ProjectsGrid>
        );
      })
    }
  </Slider>
</Section>
